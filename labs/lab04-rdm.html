<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="ENGS 199.20">
<meta name="dcterms.date" content="2025-10-10">

<title>Lab 4: Potential Pitfalls of Predict-Then-Act – ENGS 199.20 - Fall 2025</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-51708a3f6fe96a8431666b02a5f1c25b.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-857b89ac35367dc1dc1487267b3a483d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-1.2.0/all.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-1.2.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="Lab 4: Potential Pitfalls of Predict-Then-Act – ENGS 199.20 - Fall 2025">
<meta property="og:description" content="Homepage for ENGS 199.20, Decision Analysis for Wicked Climate Problems, at Dartmouth College, Fall 2025.">
<meta property="og:image" content="https://abpoll.github.io/engs199.20/_assets/img/eutrophication-system.png">
<meta property="og:site_name" content="ENGS 199.20 - Fall 2025">
<meta property="og:image:height" content="521">
<meta property="og:image:width" content="750">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <a class="flex-grow-1 no-decor" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
          <h1 class="quarto-secondary-nav-title">Lab 4: Potential Pitfalls of Predict-Then-Act</h1>
        </a>     
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../_assets/logos/D-Pine_all_formats/D-Pine_RGB.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">ENGS 199.20</a> 
        <div class="sidebar-tools-main">
    <a href="https://www.github.com/abpoll/engs199.20" title="Github Repository" class="quarto-navigation-tool px-1" aria-label="Github Repository"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../schedule/schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Labs</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../project/overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Project</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../project/updates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Module Reports</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../project/presentation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Presentation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../project/report.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Final Report</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Other Resources</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#lab-workflow" id="toc-lab-workflow" class="nav-link" data-scroll-target="#lab-workflow">Lab Workflow</a>
  <ul class="collapse">
  <li><a href="#repository-setup" id="toc-repository-setup" class="nav-link" data-scroll-target="#repository-setup">Repository Setup</a></li>
  <li><a href="#environment-setup" id="toc-environment-setup" class="nav-link" data-scroll-target="#environment-setup">Environment Setup</a></li>
  <li><a href="#our-analysis" id="toc-our-analysis" class="nav-link" data-scroll-target="#our-analysis">Our Analysis</a></li>
  <li><a href="#decision-making-under-uncertainty" id="toc-decision-making-under-uncertainty" class="nav-link" data-scroll-target="#decision-making-under-uncertainty">Decision-making under uncertainty</a></li>
  <li><a href="#wrapping-up-lab" id="toc-wrapping-up-lab" class="nav-link" data-scroll-target="#wrapping-up-lab">Wrapping up lab</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://www.github.com/abpoll/engs199.20/edit/main/labs/lab04-rdm.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://www.github.com/abpoll/engs199.20/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="lab04-rdm.ipynb" download="lab04-rdm.ipynb"><i class="bi bi-journal-code"></i>Jupyter</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Lab 4: Potential Pitfalls of Predict-Then-Act</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>ENGS 199.20 </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Due Date:</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 10, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>Today we’re going to learn about the potential pitfalls of predicting then acting for problems characterized by deep uncertainty. This lab adapts the analysis from <a href="http://dx.doi.org/10.1111/j.1539-6924.2007.00940.x">Managing the risk of uncertain threshold responses: comparison of robust, optimum, and precautionary approaches</a> by Lempert and Collins, 2007.</p>
<p>Today’s objectives:</p>
<ol type="1">
<li>Calculate the regret of a strategy in individual states and across states</li>
<li>Calculate a strategy’s satisficing robustness</li>
<li>Visualize different robustness for various metrics and strategies in insightful ways</li>
<li>Demonstrate your conceptual understanding of the two robustness criteria from the study</li>
<li>(Optional) Apply the workflow to your project data</li>
</ol>
</section>
<section id="lab-workflow" class="level2">
<h2 class="anchored" data-anchor-id="lab-workflow">Lab Workflow</h2>
<section id="repository-setup" class="level3">
<h3 class="anchored" data-anchor-id="repository-setup">Repository Setup</h3>
<p>You can call the repository <code>rdm_lab/</code>.</p>
<p>If you need a reminder on how to set up your project directory and create a GitHub repository, check the workflow and directory structure from lab 2.</p>
<p>You can directly export these lab instructions as a <code>.ipynb</code> file (look at the top right of the page). Place this file in the <code>noteboks/</code> subdirectory.</p>
</section>
<section id="environment-setup" class="level3">
<h3 class="anchored" data-anchor-id="environment-setup">Environment Setup</h3>
<p>For today’s lab, you will need to create an environment that has all the packages from lab 2, plus <code>scipy</code>.</p>
<p>Be sure to include instructions in your <code>README.md</code> about how others can prepare the computational environment to run your notebook.</p>
</section>
<section id="our-analysis" class="level3">
<h3 class="anchored" data-anchor-id="our-analysis">Our Analysis</h3>
<p>Make sure your environment is set up and active to run the code cells below.</p>
<section id="lake-problem-overview" class="level4">
<h4 class="anchored" data-anchor-id="lake-problem-overview">Lake Problem Overview</h4>
<p>Quoting from Lempert and Collins (2007): “Imagine a small village perched on the shores of a pristine lake. Many of the town’s citizens want economic development, but development will increase the pollution flowing into the lake. The citizens know that lakes such as theirs can exhibit a threshold behavior where a small pollution increase past some level may cause a clear lake to turn suddenly and sometimes irreversibly cloudy. The citizens seek a development plan that preserves the clarity of their lake, cognizant of their widely divergent values regarding environmental quality and growth, as well their divergent opinions about the level where the pollution threshold for their lake might lie. The town’s citizens also know that once permits are issued, buildings built, and pollution begins to flow it may become difficult to reverse course. Nonetheless, they must decide how much pollution they should allow to best balance their economic and environmental goals.”</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../_assets/img/eutrophication-system.png" class="img-fluid figure-img"></p>
<figcaption>Shallow Lake Model diagram from <a href="https://envsys.viveks.me/fall2025/slides/lecture03-2-equilibria-bifurcations.html#/shallow-lake-model-1">Vivek Srikrishnan’s Fall 2025 Environmental Systems Analysis Slides</a></figcaption>
</figure>
</div>
<p>The lake naturally loses and gains phosphorus (P). The lake can exist in one of two states. The desirable state, called an oligotrophic state, exists with low nutrient inputs, low to moderate levels of plant production, and relatively clear water. The undesirable state, called an eutrophic state, exists with high nutrient levels, high levels of plant production, low biodiversity, and murky water. The introduction of economic activity to the lake increases the risk of eutrophication.</p>
<p>Lempert and Collins (2007) represent the lake problem with the following equation (with a little clarification from revisiting <a href="https://doi.org/10.1890/0012-9658(2003)084%5B1403:UATMOM%5D2.0.CO;2">Peterson et al., (2003)</a>): <span class="math display">\[
X_{t+1} =
\begin{cases}
    BX_t + b_t + L_t &amp; \text{if } X_t &lt; X^{\text{crit}} \\
    BX_t + r + b_t + L_t &amp; \text{if } X_t \geq X^{\text{crit}}
\end{cases}
\]</span></p>
<p>where <span class="math inline">\(X_{t}\)</span> is the P concentration at time <span class="math inline">\(t\)</span>, <span class="math inline">\(B\)</span> is the proportion of P retained in the lake each year, <span class="math inline">\(b_{t} = (\bar{b}, \omega)\)</span> is the natural pollution flow into the lake assumed to follow a normal distribution with mean <span class="math inline">\(\bar{b}\)</span> and standard deviation <span class="math inline">\(\omega\)</span>, <span class="math inline">\(L_{t}\)</span> is the anthropogenic pollution flow, and <span class="math inline">\(r\)</span> is the amount of P recycled and maintained in the lake. <span class="math inline">\(X^{\text{crit}}\)</span> is the critical P concentration at which P recycling begins.</p>
<p>The two alternating equilibrium values are found by letting <span class="math inline">\(X_{t+1} = X{t}\)</span>:</p>
<p><span class="math display">\[
\begin{array}{l}
    X_{1*} = \frac{\bar{b} + L}{1 - B} &amp; \text{if } X_{1*} &lt; X^{\text{crit}} \\
    X_{2*} = \frac{r + \bar{b} + L}{1 - B} &amp; \text{if } X_{2*} \geq X^{\text{crit}}
\end{array}
\]</span></p>
<p>If <span class="math inline">\(X_{1*} &lt; X^{\text{crit}}\)</span> an oligotrophic equilibrium exists, and if <span class="math inline">\(X_{2*} \geq X^{\text{crit}}\)</span> a eutrophic equilibrium also exists. Because the equilibrium value of <span class="math inline">\(X\)</span> depends upon the P loading, changes in P loading can cause equilibrium point to appear or disappear. Figure 2 from Peterson et al., (2003), shown below, illustrates how changes in P loading can irreversibly alter the lake system’s outcomes:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../_assets/img/lake_two_eq.jpg" class="img-fluid figure-img"></p>
<figcaption>An illustration of the P dynamics model. In example (A), low P loading results in a single stable oligotrophic equilibrium. In (B), at a higher P loading the same lake has two stable equilibrium values—one oligotrophic (the lower point) and one eutrophic (the higher point)</figcaption>
</figure>
</div>
<p>Lempert and Collins (2007) assume that the citizens of the town gain utility by adding pollutants to the lake, but suffer a loss of utility if the lake becomes eutrophic. They represent the utility function as:</p>
<p><span class="math display">\[
U'_{t} =
\begin{cases}
    \alpha L_{t} - \phi (L_{t} - L_{t-1}) &amp; \text{if } X_t &lt; X^{\text{crit}} \\
    \alpha L_{t} - \beta - \phi (L_{t} - L_{t-1}) &amp; \text{if } X_t \geq X^{\text{crit}}
\end{cases}
\]</span></p>
<p>where <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> are constants. <span class="math inline">\(\beta &gt;&gt; \alpha L_{t}\)</span>, representing that the loss of utility in the eutrophic state (e.g., recreational and aesthetic utility) is large compared to the utility gained from pollution. The citizens also may suffer economic losses, such as costs of retrofitting infrastructure with pollution control equipment or underutilization of capital stock, if they are forced to decrease emissions below their previously allowed level. These costs are small compared to those of the eutrophic state, given by:</p>
<p><span class="math display">\[
\phi (L_{t} - L_{t-1}) =
\begin{cases}
    0 &amp; \text{if } L_{t} \geq L_{t-1} \\
    \varphi &amp; \text{if } L_{t} &lt; L_{t-1}
\end{cases}
\]</span></p>
<p>where <span class="math inline">\(\varphi\)</span> is a constant and <span class="math inline">\(\varphi &lt;&lt; \frac{\beta}{L_{t-1} - L_{t}}\)</span>.</p>
<p>The town’s decision problem is to choose a pollution series, <span class="math inline">\(\mathbf{L_t}\)</span>,</p>
<p>Lempert and Collins propose a policy rule that has three decision variables: the initial level of pollution, <span class="math inline">\(L_{0}\)</span>, the max amount of pollution per time period, <span class="math inline">\(\Delta L\)</span>, and a safety margin, <span class="math inline">\(S\)</span>. This decision strategy takes the following form:</p>
<p><span class="math display">\[
L_{t+1} =
\begin{cases}
    Max\{0, Min[L_{t} + \Delta L, L^{\text{target}}_{t}]\} &amp; \text{for } t \geq 1 \\
    L_{0} &amp; \text{for } t = 0
\end{cases}
\]</span></p>
<p>where the target emission level at time <span class="math inline">\(t\)</span> is given by:</p>
<p><span class="math display">\[
L^{\text{target}} =
\begin{cases}
    (1 - B) \langle X^{\text{crit}}_{t} \rangle - \bar{b} - S\omega  &amp; \text{if } X_{t} &lt; X^{\text{crit}} \\
    \langle X^{\text{crit}}_{t} \rangle - BX_{t} - r - \bar{b} - S\omega &amp; \text{if } X_{t} \geq X^{\text{crit}}
\end{cases}
\]</span></p>
<p>and <span class="math inline">\(\langle X^{\text{crit}}_{t} \rangle\)</span> is the town’s estimated critical threshold at the current time period. Please refer to the paper for the formulation.</p>
<p>Under an expected utility maximization framework for decision-making, the town aims to maximize the present value of utility: <span class="math inline">\(PV(U) = \sum_{t} \frac{U_{t}}{(1 + d)^{t}}\)</span>, where <span class="math inline">\(d\)</span> is the citizens’ discount rate. Given the available information to estimate <span class="math inline">\(\langle X^{\text{crit}}_{t} \rangle\)</span>, the town can find the optimal values for their decision variables. As we’ll see later in the lab (and as you already know from reading the paper), whether this is the <em>right</em> decision to make depends on how much you believe the information you have to estimate <span class="math inline">\(\langle X^{\text{crit}}_{t} \rangle\)</span>.</p>
<p>The basecase values of model parameters are as follows:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;">Parameter</th>
<th style="text-align: center;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Retained phosphorous (B)</td>
<td style="text-align: center;">.2</td>
</tr>
<tr class="even">
<td style="text-align: center;">Mean of natural emissions (<span class="math inline">\(\hat{b}\)</span>)</td>
<td style="text-align: center;">.1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Initial P concentration (<span class="math inline">\(X_{0}\)</span>)</td>
<td style="text-align: center;"><span class="math inline">\(\hat{b}\)</span>/(1 - B) = .125</td>
</tr>
<tr class="even">
<td style="text-align: center;">Std of natural emissions <span class="math inline">\(\omega\)</span></td>
<td style="text-align: center;">.04</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Recycling rate (r)</td>
<td style="text-align: center;">.25</td>
</tr>
<tr class="even">
<td style="text-align: center;">Std of measured <span class="math inline">\(X^{\text{crit}}\)</span> (<span class="math inline">\(\gamma\)</span>)</td>
<td style="text-align: center;">.05</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Distance from <span class="math inline">\(X^{\text{crit}}\)</span> required for learning (<span class="math inline">\(\lambda\)</span>)</td>
<td style="text-align: center;">.1</td>
</tr>
<tr class="even">
<td style="text-align: center;">Noise exponent (q)</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Initial estimate of observed <span class="math inline">\(X^{\text{crit}}\)</span> variance</td>
<td style="text-align: center;">.02</td>
</tr>
<tr class="even">
<td style="text-align: center;">Discount rate (d)</td>
<td style="text-align: center;">.03</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Utility from pollution (<span class="math inline">\(\alpha\)</span>)</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">Eutrophic cost (<span class="math inline">\(\beta\)</span>)</td>
<td style="text-align: center;">10</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Emissions reduction cost (<span class="math inline">\(\varphi\)</span>)</td>
<td style="text-align: center;">1</td>
</tr>
</tbody>
</table>
<p><em>Note</em>: While the table in the text has <span class="math inline">\(\varphi\)</span> as 10, the text clearly states that this emissions reduction cost is much smaller than the eutrophic cost so it is a typo. I’m guessing it’s supposed to be 1 (similarly, the initial estimate of observed <span class="math inline">\(X^{\text{crit}}\)</span> variance is a typo in the paper’s table).</p>
</section>
</section>
<section id="decision-making-under-uncertainty" class="level3">
<h3 class="anchored" data-anchor-id="decision-making-under-uncertainty">Decision-making under uncertainty</h3>
<p><strong>Note</strong> that I was not able to reproduce the results from Lempert and Collins completely. There are a few typos (e.g., see their Table on parameter values and the reported initial estiamte of observed <span class="math inline">\(X_{\text{crit}}\)</span> and the one I was able to update based on other text in the paper). There are a few decisions and implementation choices I can’t back out without more guidance, but I was able to reproduce the most relevant behavior of the inflows and policies. I made a few updates relative to the policy rules as written in the manuscript:</p>
<ol type="1">
<li>I estimate the new best guess for <span class="math inline">\(X_{\text{crit}}\)</span> based on the current best guess for variance. The notation as currently written suggests we calculate the new variance before updating our mean estimate.</li>
<li>I limit updates on standard deviation of <span class="math inline">\(X_{\text{crit}}\)</span> to double our intial guess. If we don’t do this, there is too much noise in early draws and we can’t identify when our initial guess is lower than <span class="math inline">\(X^{\text{true}}_{\text{crit}}\)</span>. I think this biases our representation a bit more towards trusting our priors than the Lempert and Collins paper, but I can’t otherwise figure out how to get the same learning behavior as them for Strategy A when <span class="math inline">\(X^{\text{true}}_{\text{crit}}\)</span> = .9.</li>
</ol>
<p>Anyone who wants to review the paper and code and reconcile any major differences with explanations or code updates is more than welcome!</p>
<p>Because the code below does reproduce key behavior of the inflows and policies, all of the lessons about robustness are the same and that’s the key point of this lab.</p>
<p>Ok! Moving on…</p>
<p>Adapting the narrative of Lempert and Collins slightly, suppose the town reviewed scientific evidence of nearby lakes and concludes that <span class="math inline">\(X_{\text{crit}}\)</span> lies between .3 and .9. The current best evidence suggets <span class="math inline">\(X_{\text{crit}} \sim N(.8, .138)\)</span>.</p>
<p>If the town has 100% confidence in this belief, the optimal strategy (called Strategy A) has: <span class="math inline">\(L_{0} = .31\)</span>, <span class="math inline">\(\Delta L = .027\)</span> <span class="math inline">\(S = 2.8\)</span></p>
<p>Assume that the true value of <span class="math inline">\(X_{\text{crit}}\)</span> is .9. What does the pollution concentration of the lake look like over 100 years? What about if the true value is .3?</p>
<div id="17e7ac96" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> truncnorm</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters (Table I / paper)</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> <span class="fl">0.20</span>           <span class="co"># retained phosphorus</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>b_bar <span class="op">=</span> <span class="fl">0.10</span>       <span class="co"># mean natural emissions</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>omega <span class="op">=</span> <span class="fl">0.04</span>       <span class="co"># std dev natural emissions</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.25</span>           <span class="co"># recycling jump when X &gt;= Xcrit</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>gamma_obs <span class="op">=</span> <span class="fl">0.05</span>   <span class="co"># baseline observation noise std</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>lambda_learn <span class="op">=</span> <span class="fl">0.10</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>q_noise <span class="op">=</span> <span class="fl">2.0</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>initial_var <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>beta <span class="op">=</span> <span class="fl">10.0</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>phi <span class="op">=</span> <span class="fl">1.0</span> <span class="co"># table says 10 but the text says &lt;&lt; beta</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>discount_rate <span class="op">=</span> <span class="fl">0.03</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Strategy A (given)</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>strategy_A <span class="op">=</span> {<span class="st">"L0"</span>: <span class="fl">0.31</span>, <span class="st">"dL"</span>: <span class="fl">0.027</span>, <span class="st">"S"</span>: <span class="fl">2.8</span>}</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulation controls</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">100</span>                <span class="co"># years</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>Nsim <span class="op">=</span> <span class="dv">100</span>             <span class="co"># ensemble size for mean / quantiles (set e.g., 100 for demo)</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>SEED <span class="op">=</span> <span class="dv">42</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>rng_global <span class="op">=</span> np.random.default_rng(SEED)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial estimate used by the town</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>initial_est_mean <span class="op">=</span> <span class="fl">0.787</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>initial_est_var <span class="op">=</span> initial_var</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>est_lower <span class="op">=</span> <span class="fl">.3</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>est_upper <span class="op">=</span> <span class="fl">.9</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper functions implementing paper's learning and policy rules</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gamma_t_func(Xt, Xcrit_true, gamma<span class="op">=</span>gamma_obs, lam<span class="op">=</span>lambda_learn, q<span class="op">=</span>q_noise):</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Equation (6): observation noise depends on proximity to threshold."""</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> Xt <span class="op">&gt;=</span> Xcrit_true:</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">float</span>(gamma)</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    exponent <span class="op">=</span> ((Xcrit_true <span class="op">-</span> Xt) <span class="op">/</span> lam) <span class="op">**</span> q</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">min</span>(gamma <span class="op">*</span> math.exp(exponent), <span class="fl">.1</span>)         </span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> kalman_update(mean_prev, var_prev, Zt, gamma_t):</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Scalar Kalman-like update (Equation (5))"""</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    K <span class="op">=</span> var_prev <span class="op">/</span> (var_prev <span class="op">+</span> gamma_t)</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    mean_new <span class="op">=</span> mean_prev <span class="op">+</span> K <span class="op">*</span> (Zt <span class="op">-</span> mean_prev)</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    var_new <span class="op">=</span> (var_prev <span class="op">*</span> gamma_t) <span class="op">/</span> (var_prev <span class="op">+</span> gamma_t)</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mean_new, var_new</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> target_emission_level(estimated_Xcrit, Xt, Xcrit_true, S):</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Equation (8) for L_target"""</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> Xt <span class="op">&lt;</span> Xcrit_true:</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>        target <span class="op">=</span> (<span class="fl">1.0</span> <span class="op">-</span> B) <span class="op">*</span> estimated_Xcrit <span class="op">-</span> b_bar <span class="op">-</span> S <span class="op">*</span> omega</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>        target <span class="op">=</span> estimated_Xcrit <span class="op">-</span> B <span class="op">*</span> Xt <span class="op">-</span> r <span class="op">-</span> b_bar <span class="op">-</span> S <span class="op">*</span> omega</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">max</span>(<span class="fl">0.0</span>, target)</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> next_L(Lt, L_arg, dL):</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Equation (7) update for L"""</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">max</span>(<span class="fl">0.0</span>, <span class="bu">min</span>(Lt <span class="op">+</span> dL, L_arg))</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simulate_one_run_with_learning(Xcrit_true,</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>                                   policy,</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>                                   T<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>                                   rng<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>                                   est_mean_init<span class="op">=</span>initial_est_mean, est_var_init<span class="op">=</span>initial_est_var):</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a><span class="co">    Simulate one stochastic run with Kalman learning and the adaptive policy (L0, dL, S).</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns time series dict with keys: X, L, est (estimated Xcrit), U (period utilities)</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rng <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>        rng <span class="op">=</span> np.random.default_rng()</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>    L0 <span class="op">=</span> <span class="bu">float</span>(policy[<span class="st">"L0"</span>]) </span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>    dL <span class="op">=</span> <span class="bu">float</span>(policy[<span class="st">"dL"</span>])</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    S <span class="op">=</span> <span class="bu">float</span>(policy[<span class="st">"S"</span>])</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> np.empty(T)</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>    L <span class="op">=</span> np.empty(T)</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>    Z <span class="op">=</span> np.empty(T)</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    est <span class="op">=</span> np.empty(T)</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>    U <span class="op">=</span> np.empty(T)</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>    Xt <span class="op">=</span> b_bar <span class="op">/</span> (<span class="fl">1.0</span> <span class="op">-</span> B)  <span class="co"># initial concentration per paper</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>    L_prev <span class="op">=</span> L0</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>    L_curr <span class="op">=</span> L0</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>    est_mean <span class="op">=</span> est_mean_init</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>    est_var <span class="op">=</span> est_var_init</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(T):</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>        <span class="co"># natural inflow</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>        bt <span class="op">=</span> rng.normal(b_bar, omega)</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>        <span class="co"># update concentration (Eqn 1)</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> Xt <span class="op">&gt;=</span> Xcrit_true:</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>            Xt_next <span class="op">=</span> B <span class="op">*</span> Xt <span class="op">+</span> r <span class="op">+</span> bt <span class="op">+</span> L_curr</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>            Xt_next <span class="op">=</span> B <span class="op">*</span> Xt <span class="op">+</span> bt <span class="op">+</span> L_curr</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>        <span class="co"># observation for learning: Zt ~ N(Xcrit_true, gamma_t)</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>        gamma_t <span class="op">=</span> gamma_t_func(Xt, Xcrit_true)</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>        Zt <span class="op">=</span> rng.normal(loc<span class="op">=</span>Xcrit_true, scale<span class="op">=</span>gamma_t)</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Kalman update</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>        est_mean, est_var <span class="op">=</span> kalman_update(est_mean, est_var, Zt, gamma_t)</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>        <span class="co"># utility for this period (using current Xt and current emissions L_curr)</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>        reduction_cost <span class="op">=</span> phi <span class="op">*</span> <span class="bu">max</span>(<span class="fl">0.0</span>, L_prev <span class="op">-</span> L_curr)</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>        eutrophic_penalty <span class="op">=</span> beta <span class="cf">if</span> Xt <span class="op">&gt;=</span> Xcrit_true <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>        U[t] <span class="op">=</span> alpha <span class="op">*</span> L_curr <span class="op">-</span> reduction_cost <span class="op">-</span> eutrophic_penalty</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>        <span class="co"># record</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>        X[t] <span class="op">=</span> Xt</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>        L[t] <span class="op">=</span> L_curr</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>        est[t] <span class="op">=</span> est_mean</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>        <span class="co"># compute target and update emissions</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>        L_targ <span class="op">=</span> target_emission_level(est_mean, Xt, Xcrit_true, S)</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>        L_next <span class="op">=</span> next_L(L_curr, L_targ, dL)</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>        L_prev <span class="op">=</span> L_curr</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>        L_curr <span class="op">=</span> L_next</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>        Xt <span class="op">=</span> Xt_next</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"X"</span>: X, <span class="st">"L"</span>: L, <span class="st">"est"</span>: est, <span class="st">"U"</span>: U}</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------</span></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a><span class="co"># Run simulation </span></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------</span></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>all_X <span class="op">=</span> np.zeros((Nsim, T))</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>all_L <span class="op">=</span> np.zeros((Nsim, T))</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>all_est <span class="op">=</span> np.zeros((Nsim, T))</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>all_U <span class="op">=</span> np.zeros((Nsim, T))</span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>all_X2 <span class="op">=</span> np.zeros((Nsim, T))</span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>all_L2 <span class="op">=</span> np.zeros((Nsim, T))</span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>all_est2 <span class="op">=</span> np.zeros((Nsim, T))</span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>all_U2 <span class="op">=</span> np.zeros((Nsim, T))</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a><span class="co"># True Xcrits for this illustration</span></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>xcrit_list <span class="op">=</span> [<span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>]</span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>n_x <span class="op">=</span> <span class="bu">len</span>(xcrit_list)</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a><span class="co"># pre-allocate arrays: shape (n_x, Nsim, T)</span></span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>all_X <span class="op">=</span> np.zeros((n_x, Nsim, T))</span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>all_L <span class="op">=</span> np.zeros((n_x, Nsim, T))</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>all_est <span class="op">=</span> np.zeros((n_x, Nsim, T))</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>all_U <span class="op">=</span> np.zeros((n_x, Nsim, T))</span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a><span class="co"># Pre-generate natural inflows bt_samples for each Monte Carlo run (CRN across Xcrit)</span></span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>rng_global <span class="op">=</span> np.random.default_rng(SEED)</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>bt_samples <span class="op">=</span> rng_global.normal(loc<span class="op">=</span>b_bar, scale<span class="op">=</span>omega, size<span class="op">=</span>(Nsim, T))</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a><span class="co"># Run ensemble</span></span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(Nsim):</span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create per-run rng for observation draws (do not re-seed inside loop)</span></span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>    rng_i <span class="op">=</span> np.random.default_rng(SEED <span class="op">+</span> <span class="dv">1000</span> <span class="op">+</span> i)</span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j, xcrit <span class="kw">in</span> <span class="bu">enumerate</span>(xcrit_list):</span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>        out <span class="op">=</span> simulate_one_run_with_learning(Xcrit_true<span class="op">=</span>xcrit,</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>                                             policy<span class="op">=</span>strategy_A,</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>                                             T<span class="op">=</span>T,</span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>                                             rng<span class="op">=</span>rng_i,</span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>                                             est_mean_init<span class="op">=</span>initial_est_mean,</span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>                                             est_var_init<span class="op">=</span>initial_est_var)</span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>        all_X[j, i, :] <span class="op">=</span> out[<span class="st">"X"</span>]</span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>        all_L[j, i, :] <span class="op">=</span> out[<span class="st">"L"</span>]</span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>        all_est[j, i, :] <span class="op">=</span> out[<span class="st">"est"</span>]</span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>        all_U[j, i, :] <span class="op">=</span> out[<span class="st">"U"</span>]</span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------</span></span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot results: mean concentration, emissions, and estimated Xcrit</span></span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------</span></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>years <span class="op">=</span> np.arange(<span class="dv">1</span>, T<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a><span class="co"># Top: concentration and estimated threshold</span></span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].plot(years, all_X[<span class="op">-</span><span class="dv">1</span>].mean(axis<span class="op">=</span><span class="dv">0</span>), color<span class="op">=</span><span class="st">"C0"</span>, label<span class="op">=</span><span class="st">"Mean P concentration (X_t)"</span>)</span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].fill_between(years,</span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>                   np.percentile(all_X[<span class="op">-</span><span class="dv">1</span>], <span class="dv">5</span>, axis<span class="op">=</span><span class="dv">0</span>),</span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>                   np.percentile(all_X[<span class="op">-</span><span class="dv">1</span>], <span class="dv">95</span>, axis<span class="op">=</span><span class="dv">0</span>),</span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>                   alpha<span class="op">=</span><span class="fl">.2</span>,</span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>                   color<span class="op">=</span><span class="st">"C0"</span>, label<span class="op">=</span><span class="st">"95% bounds across realizations"</span>)</span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].plot(years, all_L[<span class="op">-</span><span class="dv">1</span>].mean(axis<span class="op">=</span><span class="dv">0</span>), color<span class="op">=</span><span class="st">"C2"</span>, label<span class="op">=</span><span class="st">"Mean anthropogenic flow (L_t)"</span>)</span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].plot(years, all_est[<span class="op">-</span><span class="dv">1</span>].mean(axis<span class="op">=</span><span class="dv">0</span>), color<span class="op">=</span><span class="st">"C1"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, label<span class="op">=</span><span class="st">"Mean estimated Xcrit"</span>)</span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].axhline(xcrit_list[<span class="op">-</span><span class="dv">1</span>], color<span class="op">=</span><span class="st">"k"</span>, linestyle<span class="op">=</span><span class="st">":"</span>, label<span class="op">=</span><span class="ss">f"True Xcrit = </span><span class="sc">{</span>xcrit_list[<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylabel(<span class="st">"Phosphorus concentration"</span>)</span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_title(<span class="st">"Strategy A (L0=0.31, ΔL=0.027, S=2.8)"</span>)</span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].legend()</span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].plot(years, all_X[<span class="dv">0</span>].mean(axis<span class="op">=</span><span class="dv">0</span>), color<span class="op">=</span><span class="st">"C0"</span>, label<span class="op">=</span><span class="st">"Mean P concentration (X_t)"</span>)</span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].fill_between(years,</span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>                   np.percentile(all_X[<span class="dv">0</span>], <span class="dv">5</span>, axis<span class="op">=</span><span class="dv">0</span>),</span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>                   np.percentile(all_X[<span class="dv">0</span>], <span class="dv">95</span>, axis<span class="op">=</span><span class="dv">0</span>),</span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>                   alpha<span class="op">=</span><span class="fl">.2</span>,</span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>                   color<span class="op">=</span><span class="st">"C0"</span>, label<span class="op">=</span><span class="st">"95% bounds across realizations"</span>)</span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].plot(years, all_L[<span class="dv">0</span>].mean(axis<span class="op">=</span><span class="dv">0</span>), color<span class="op">=</span><span class="st">"C2"</span>, label<span class="op">=</span><span class="st">"Mean anthropogenic flow (L_t)"</span>)</span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].plot(years, all_est[<span class="dv">0</span>].mean(axis<span class="op">=</span><span class="dv">0</span>), color<span class="op">=</span><span class="st">"C1"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, label<span class="op">=</span><span class="st">"Mean estimated Xcrit"</span>)</span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].axhline(xcrit_list[<span class="dv">0</span>], color<span class="op">=</span><span class="st">"k"</span>, linestyle<span class="op">=</span><span class="st">":"</span>, label<span class="op">=</span><span class="ss">f"True Xcrit = </span><span class="sc">{</span>xcrit_list[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylabel(<span class="st">"Phosphorus concentration"</span>)</span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_title(<span class="st">"Strategy A (L0=0.31, ΔL=0.027, S=2.8)"</span>)</span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].legend(loc<span class="op">=</span><span class="st">'lower right'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="lab04-rdm_files/figure-html/cell-2-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>When the neighboring lakes’ statistics are represenative of the town’s lake (top panel, true Xcrit = 0.9), Strategy A lets emissions ramp up and stabilizes at a moderate level that keeps the mean phosphorus concentration under the town’s safety buffer. When the assessment is badly wrong (bottom panel, true Xcrit = 0.3), the initial policy overcommits — the emissions (and then concentration) rise, the town’s estimate of <span class="math inline">\(X_{\text{crit}}\)</span> is revised downward as observations arrive, and emissions are sharply cut only after the system has already been driven into the eutrophic equilibrium. This illustrates how a predict‑then‑act rule that trusts a single prior can be fragile under deep uncertainty.</p>
<p>How much would the town regret going with Strategy A if <span class="math inline">\(X^{\text{true}}_{\text{crit}}\)</span> = .3?</p>
<p>To estimate this, we are going to consider the town’s uncertainty about their estimate of the value of <span class="math inline">\(X_{\text{crit}}\)</span> as well as epistemic uncertainty about whether this is the <em>correct</em> distribution to characterize <span class="math inline">\(X_{\text{crit}}\)</span>.</p>
<p>Recall from lecture that the regret of action <em>a</em> in state <em>x</em> is:</p>
<p><span class="math inline">\(R_{a}(x) = Max_{a'}[PV(U_{a'}(x))] - PV(U_{a}(x))\)</span>,</p>
<p>the difference between the present value expected utility of the <em>optimal</em> action in a considered state of the world and the <em>considered</em> action’s present value expected utility in that state of the world.</p>
<p>Considering the probability distribution <span class="math inline">\(p_{i}(x)\)</span> over possible states of the world, the expected regret of action <em>a</em> on distribution <em>i</em> is:</p>
<p><span class="math display">\[
\bar{R}_{a, i} = \int_{x} R_{a}(x)p_{i}(x)dx
\]</span></p>
<p>I use actions, <em>a</em>, as opposed to strategies in this formulation because it is consistent with the original derivation in <a href="http://dx.doi.org/10.1080/01621459.1951.10500768">Savage (1951)</a>. Otherwise, the notation is consistent with the formulation in Lempert and Collins. <em>x</em> refers to the possible values for <span class="math inline">\(X_{\text{crit}}\)</span> and <em>i</em> refers to a specific prior distribution for <span class="math inline">\(X_{\text{crit}}\)</span>.</p>
<p>For different values of <span class="math inline">\(X_{\text{crit}}\)</span>, we can estimate the town’s expected regret for placing all of their trust in the commissioned science assessment. Lempert and Collins provide several other strategies, B-G. For different values of <span class="math inline">\(X_{\text{crit}}\)</span>, we can calculate which of the strategies A-G is optimal and then calculate the expected regret of choosing Strategy A based on the town’s prior distribution for A. Lempert and Collins presumably identify the optimal strategy for each <span class="math inline">\(X_{\text{crit}}\)</span> and calculate regret based on that, but we are just going to use the strategies provided to simplify things.</p>
<p>We’ll start with the example of <span class="math inline">\(X_{\text{crit}}\)</span> = .3, which corresponds to the bottom panel of the figure we generated above. At <span class="math inline">\(X_{\text{crit}}\)</span> = .3, Strategy G is optimal out of the strategies under consideration. Lempert and Collins don’t report the decision variables for this strategy, but we can get a very similar strategy to G by looking at Figure 6. It looks like <span class="math inline">\(L_{0} = 0.01\)</span>, <span class="math inline">\(\Delta L = 0.01\)</span> and <span class="math inline">\(S = 5.8\)</span>.</p>
<p>We’ll build up slowly to expected regret over a prior distribution by first calculating the regret of Strategy A in the scenario where <span class="math inline">\(X_{\text{crit}}\)</span> = 0.3. We need to calculate:</p>
<p><span class="math inline">\(R_{A}(0.3) = PV(U_{G}(0.3)) - PV(U_{A}(0.3))\)</span></p>
<p>We’ll calculate the expected present value of utility of each strategy when <span class="math inline">\(X_{\text{crit}}\)</span> = .3 and then the difference.</p>
<div id="162a63c2" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Strategy G (guessed from Fig. 6)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>strategy_G <span class="op">=</span> {<span class="st">"L0"</span>: <span class="fl">0.01</span>, <span class="st">"dL"</span>: <span class="fl">0.01</span>, <span class="st">"S"</span>: <span class="fl">5.8</span>}</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the utility array for strategy G</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>strat_g_U <span class="op">=</span> np.zeros((n_x, Nsim, T))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Run ensemble for Strategy G</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(Nsim):</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create per-run rng for observation draws (do not re-seed inside loop)</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    rng_i <span class="op">=</span> np.random.default_rng(SEED <span class="op">+</span> <span class="dv">1000</span> <span class="op">+</span> i)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j, xcrit <span class="kw">in</span> <span class="bu">enumerate</span>(xcrit_list):</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        out <span class="op">=</span> simulate_one_run_with_learning(Xcrit_true<span class="op">=</span>xcrit,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>                                             policy<span class="op">=</span>strategy_G,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>                                             T<span class="op">=</span>T,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>                                             rng<span class="op">=</span>rng_i,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>                                             est_mean_init<span class="op">=</span>initial_est_mean,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>                                             est_var_init<span class="op">=</span>initial_est_var)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        strat_g_U[j, i, :] <span class="op">=</span> out[<span class="st">"U"</span>]</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute present value of utility.</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Discount factors (length T)</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> np.arange(T)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>discount_factors <span class="op">=</span> <span class="fl">1.0</span> <span class="op">/</span> ((<span class="fl">1.0</span> <span class="op">+</span> discount_rate) <span class="op">**</span> t)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>pv_A_samples <span class="op">=</span> np.<span class="bu">sum</span>(all_U[<span class="dv">0</span>, :, :] <span class="op">*</span> discount_factors, axis<span class="op">=</span><span class="dv">1</span>) </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>pv_G_samples <span class="op">=</span> np.<span class="bu">sum</span>(strat_g_U[<span class="dv">0</span>, :, :] <span class="op">*</span> discount_factors, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate expected values and report both and difference</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>mean_pv_A <span class="op">=</span> pv_A_samples.mean()</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>mean_pv_G <span class="op">=</span> pv_G_samples.mean()</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>g_best_regret <span class="op">=</span> mean_pv_G <span class="op">-</span> mean_pv_A</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Strategy A: mean PV = </span><span class="sc">{:.2f}</span><span class="st">"</span>.<span class="bu">format</span>(mean_pv_A))</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Strategy G: mean PV = </span><span class="sc">{:.2f}</span><span class="st">"</span>.<span class="bu">format</span>(mean_pv_G))</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">" Regret = </span><span class="sc">{:.2f}</span><span class="st">"</span>.<span class="bu">format</span>(g_best_regret))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Strategy A: mean PV = -310.81
Strategy G: mean PV = -17.38
 Regret = 293.43</code></pre>
</div>
</div>
<p>And we can do the same for when <span class="math inline">\(X^{\text{crit}}\)</span> = .9 but this time we treat Strategy A as the optimal policy.</p>
<div id="69a77ef7" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute present value of utility.</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Discount factors (length T)</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> np.arange(T)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>discount_factors <span class="op">=</span> <span class="fl">1.0</span> <span class="op">/</span> ((<span class="fl">1.0</span> <span class="op">+</span> discount_rate) <span class="op">**</span> t)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>pv_A_samples <span class="op">=</span> np.<span class="bu">sum</span>(all_U[<span class="op">-</span><span class="dv">1</span>, :, :] <span class="op">*</span> discount_factors, axis<span class="op">=</span><span class="dv">1</span>) </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>pv_G_samples <span class="op">=</span> np.<span class="bu">sum</span>(strat_g_U[<span class="op">-</span><span class="dv">1</span>, :, :] <span class="op">*</span> discount_factors, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate expected values and report both and difference</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>mean_pv_A <span class="op">=</span> pv_A_samples.mean()</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>mean_pv_G <span class="op">=</span> pv_G_samples.mean()</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>a_best_regret <span class="op">=</span> mean_pv_A <span class="op">-</span> mean_pv_G</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Strategy A: mean PV = </span><span class="sc">{:.2f}</span><span class="st">"</span>.<span class="bu">format</span>(mean_pv_A))</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Strategy G: mean PV = </span><span class="sc">{:.2f}</span><span class="st">"</span>.<span class="bu">format</span>(mean_pv_G))</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">" Regret = </span><span class="sc">{:.2f}</span><span class="st">"</span>.<span class="bu">format</span>(a_best_regret))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Strategy A: mean PV = 15.24
Strategy G: mean PV = 7.27
 Regret = 7.98</code></pre>
</div>
</div>
<section id="criterion-1-trading-off-optimality-for-less-sensitivity-to-unverifiable-assumptions" class="level4">
<h4 class="anchored" data-anchor-id="criterion-1-trading-off-optimality-for-less-sensitivity-to-unverifiable-assumptions">Criterion 1: trading-off optimality for less sensitivity to unverifiable assumptions</h4>
<p>How do we reconcile the differences in present value expected utility and expected regret? Lempert and Collins define a robust strategy as one that will have a smaller value of the weighted average of the best and worst case regrets compared to the strategy that optimizes expected utility, which we can represent as:</p>
<p><span class="math display">\[
V_{s} = z*\bar{R}_{s, \text{best}} + (1-z)*\bar{R}_{s, \text{worst}}
\]</span></p>
<p>where <span class="math inline">\(0 \leq z \leq 1\)</span> and represents our belief in <span class="math inline">\(p_{\text{best}(x)}\)</span>.</p>
<p>When <span class="math inline">\(z\)</span> = 1, there is only one probability distribution under consideration - the town’s best guess. In this case, the equation above preserves the ordering of strategies produced by an expected utility calculation. When <span class="math inline">\(z\)</span> = 0, the criterion is equivalent to avoiding worst-case utility. When <span class="math inline">\(z\)</span> is in between, it is possible to identify the strategy that minimizes expected regret as a function of a decisionmaker’s odds that the initial probability distribution is correct (Fig. 7 in the paper). The odds are <span class="math inline">\(\frac{z}{(1-z)}\)</span>.</p>
<p>How confident does the town have to be in the scientific assessment to stick with Strategy A? To do this, we’ll calculate <span class="math inline">\(V_{s}\)</span> for strategies A and G over a wide range of values for <span class="math inline">\(z\)</span>. Since we are only considering strategies A and G:</p>
<p><span class="math inline">\(\bar{R}_{A, \text{best}}\)</span> is 0, <span class="math inline">\(\bar{R}_{A, \text{worst}}\)</span> is the regret we calculated when <span class="math inline">\(X_{crit}\)</span> = 0.3, <span class="math inline">\(\bar{R}_{G, \text{best}}\)</span> is the regret we calculated when <span class="math inline">\(X_{crit}\)</span> = 0.9, and <span class="math inline">\(\bar{R}_{G, \text{worst}}\)</span> is 0.</p>
<div id="4abc9418" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculated V_s</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> weighted_regret(z, best_regret, worst_regret):</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> z<span class="op">*</span>(best_regret) <span class="op">+</span> (<span class="dv">1</span><span class="op">-</span>z)<span class="op">*</span>(worst_regret)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Odds from 0.01 to 100</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct odds grid (log-spaced) and convert to z = odds/(1+odds)</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>odds <span class="op">=</span> np.logspace(<span class="op">-</span><span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">500</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>z_list <span class="op">=</span> odds <span class="op">/</span> (<span class="fl">1.0</span> <span class="op">+</span> odds)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate V_A and V_G over odds</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>V_A <span class="op">=</span> z_list <span class="op">*</span> <span class="dv">0</span> <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> z_list) <span class="op">*</span> g_best_regret</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>V_G <span class="op">=</span> z_list <span class="op">*</span> a_best_regret <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> z_list) <span class="op">*</span> <span class="dv">0</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot odds against weighted regret</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>ax.plot(odds, V_A, label<span class="op">=</span><span class="st">'V_A (weighted regret for A)'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>ax.plot(odds, V_G, label<span class="op">=</span><span class="st">'V_G (weighted regret for G)'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"V_s (weighted expected regret)"</span>, size<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>ax.set_xscale(<span class="st">'log'</span>)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co"># integer ticks to show (only those within the odds range will be used)</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>integer_ticks <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">500</span>, <span class="dv">1000</span>]</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose x limits: show more of odds &gt; 10 — e.g., start at 0.1 to include small odds too</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>ax.set_xlim(<span class="fl">0.1</span>, <span class="dv">1000</span>)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only ticks that fall inside the x limits</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>ticks_in_range <span class="op">=</span> [t <span class="cf">for</span> t <span class="kw">in</span> integer_ticks <span class="cf">if</span> (t <span class="op">&gt;=</span> ax.get_xlim()[<span class="dv">0</span>] <span class="kw">and</span> t <span class="op">&lt;=</span> ax.get_xlim()[<span class="dv">1</span>])]</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(ticks_in_range)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Label ticks as integers (no decimals)</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels([<span class="bu">str</span>(<span class="bu">int</span>(t)) <span class="cf">for</span> t <span class="kw">in</span> ticks_in_range])</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Odds of Strategy A's Priors"</span>, size<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>ax.set_ylim([<span class="dv">0</span>, <span class="dv">50</span>])</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>ax.tick_params(labelsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>ax.legend(fontsize<span class="op">=</span><span class="st">'large'</span>)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="lab04-rdm_files/figure-html/cell-5-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Based on this figure and fig.&nbsp;7 in the paper, we can make a few observations about robust decision-making with this criterion. First, because of how poorly strategy A performs under low <span class="math inline">\(X^{true}_{crit}\)</span>, the town should be very confident in the scientific assessment to go with strategy A. Second, having more strategy options (fig.&nbsp;7 in the paper) can help decisionmakers make more robust decisions under a wide range of beliefs.</p>
</section>
<section id="criterion-2-performing-well-over-a-wide-range-of-plausible-futures" class="level4">
<h4 class="anchored" data-anchor-id="criterion-2-performing-well-over-a-wide-range-of-plausible-futures">Criterion 2: performing well over a wide range of plausible futures</h4>
<p>We’ll now shift our attention to a second robustness criterion: satisficing over a wide range of futures. While decisionmakers may want to identify satisficing strategies over multiple objectives, Lempert and Collins use regret for this criterion. This translates to finding a strategy that has low regret for many values of <span class="math inline">\(X^{true}_{crit}\)</span>. In the paper, they define arbitrary cutoffs for what constitutes “good enough” regret. In practice, analysts and decisionmakers often iterate on defining a satisficing threshold based on visualizations about strategy performance over a wide range of futures and refined sets of strategies.</p>
<p>We’re going to consider both the net present value of expected utility and regret for strategies A and G.</p>
<div id="06acfcc2" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Helpful for getting the pv for multiple xcrit</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_pvs_from_U(U_array, discount_rate):</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    U <span class="op">=</span> np.asarray(U_array)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> np.arange(U.shape[<span class="dv">2</span>])</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    discount_factors <span class="op">=</span> <span class="fl">1.0</span> <span class="op">/</span> ((<span class="fl">1.0</span> <span class="op">+</span> discount_rate) <span class="op">**</span> t)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    pv <span class="op">=</span> (U <span class="op">*</span> discount_factors).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">2</span>) </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pv</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>pv_A_samples <span class="op">=</span> compute_pvs_from_U(all_U, discount_rate)     </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>pv_G_samples <span class="op">=</span> compute_pvs_from_U(strat_g_U, discount_rate)  </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean present value over each xcrit</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Same index as all_U and strat_g_U</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>mean_pv_A <span class="op">=</span> pv_A_samples.mean(axis<span class="op">=</span><span class="dv">1</span>)  </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>mean_pv_G <span class="op">=</span> pv_G_samples.mean(axis<span class="op">=</span><span class="dv">1</span>) </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate regret</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Two strategies under consideration, so regret is</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 0 when one of the strategies is better for a xcrit value</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>pv_best_by_x <span class="op">=</span> np.maximum(mean_pv_A, mean_pv_G) </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>regret_A <span class="op">=</span> pv_best_by_x <span class="op">-</span> mean_pv_A</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>regret_G <span class="op">=</span> pv_best_by_x <span class="op">-</span> mean_pv_G</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot regret over critical x values in one panel</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot present value expected utility in the other</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co"># x values (e.g., xcrit_list)</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.array(xcrit_list)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>n_x <span class="op">=</span> <span class="bu">len</span>(x)</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="co"># bar width and positions</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="fl">0.35</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>xpos <span class="op">=</span> np.arange(n_x)</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">2</span>, sharex<span class="op">=</span><span class="va">True</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Top: expected PV bars</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>ax0 <span class="op">=</span> ax[<span class="dv">0</span>]</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>ax0.bar(xpos <span class="op">-</span> width<span class="op">/</span><span class="dv">2</span>, mean_pv_A, width<span class="op">=</span>width, color<span class="op">=</span><span class="st">'C0'</span>, label<span class="op">=</span><span class="st">'Strategy A'</span>)</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>ax0.bar(xpos <span class="op">+</span> width<span class="op">/</span><span class="dv">2</span>, mean_pv_G, width<span class="op">=</span>width, color<span class="op">=</span><span class="st">'C1'</span>, label<span class="op">=</span><span class="st">'Strategy G'</span>)</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>ax0.set_ylabel(<span class="st">'Present value utility'</span>, size<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>ax0.legend()</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>ax0.grid(axis<span class="op">=</span><span class="st">'y'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Bottom: regret bars</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> ax[<span class="dv">1</span>]</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>ax1.bar(xpos <span class="op">-</span> width<span class="op">/</span><span class="dv">2</span>, regret_A, width<span class="op">=</span>width, color<span class="op">=</span><span class="st">'C0'</span>)</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>ax1.bar(xpos <span class="op">+</span> width<span class="op">/</span><span class="dv">2</span>, regret_G, width<span class="op">=</span>width, color<span class="op">=</span><span class="st">'C1'</span>)</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Regret'</span>, size<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>ax1.grid(axis<span class="op">=</span><span class="st">'y'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a><span class="co"># x ticks and labels</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>ax1.set_xticks(xpos)</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>ax1.set_xticklabels([<span class="ss">f"</span><span class="sc">{</span>val<span class="sc">:.2f}</span><span class="ss">"</span> <span class="cf">for</span> val <span class="kw">in</span> x])</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Xcrit'</span>, size<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_yscale(<span class="st">'symlog'</span>)</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_yscale(<span class="st">'symlog'</span>)</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>ax0.tick_params(labelsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>ax1.tick_params(labelsize<span class="op">=</span><span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="lab04-rdm_files/figure-html/cell-6-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This kind of visualization helps put into context the relative performance of the strategies for different scenarios of <span class="math inline">\(X_{crit}\)</span>. For example, Lempert and Collins suggest that regret &lt;= 12 is acceptable. According to our calculations, unacceptable regret only becomes an issue if the true <span class="math inline">\(X_{crit}\)</span> is less than .6. From a satisficing perspective, if we wanted to ensure acceptable regret, we would prefer Strategy G because it robustly achieves that goal. We could also consider an alternative threshold, such as positive utility. Strategy G would be more robust than strategy A because it has positive utility over more scenarios of <span class="math inline">\(X_{crit}\)</span>. Note that the satisficing approach does not account for beliefs about the probability of different values for <span class="math inline">\(X_{crit}\)</span>. This may not be an appropriate assumption for all situations, but it can still be helpful to represent robustness in multiple ways.</p>
</section>
</section>
<section id="wrapping-up-lab" class="level3">
<h3 class="anchored" data-anchor-id="wrapping-up-lab">Wrapping up lab</h3>
<p>There is no separate lab report this week. The project progress report will ask you to think hard about this lab, but I would prefer you spend your time and effort on your project than this toy example.</p>
<p>You are free to experiment with the code from this lab, or adapt any of the code to expand the analysis or test your understanding. I am happy to take a look and provide feedback or talk through challenging concepts.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/abpoll\.github\.io\/engs199\.20");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          trigger: 'click',
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          positionFixed: true,
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Content <i class="fa-solid fa-copyright" aria-label="copyright"></i> 2025 by <a href="https://abpoll.github.io">Adam Pollack</a>. All content licensed under a <i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> <i class="fa-brands fa-creative-commons-by" aria-label="creative-commons-by"></i> <i class="fa-brands fa-creative-commons-nc" aria-label="creative-commons-nc"></i> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International license (CC BY-NC-SA 4.0)</a></p>
</div>   
    <div class="nav-footer-center">
<p><strong>Page still under construction.</strong></p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://www.github.com/abpoll/engs199.20/edit/main/labs/lab04-rdm.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://www.github.com/abpoll/engs199.20/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Made with <a href="https://www.python.org/">Python</a> and <a href="https://quarto.org/">Quarto</a><br> <a href="https://www.github.com/abpoll/engs199.20">View the source on <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></p>
</div>
  </div>
</footer>




</body></html>